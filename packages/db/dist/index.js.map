{"version":3,"sources":["../src/index.ts","../src/schema.ts"],"sourcesContent":["import { drizzle } from 'drizzle-orm/postgres-js';\r\nimport postgres from 'postgres';\r\nimport * as schema from './schema';\r\n\r\nconst connectionString = process.env.DATABASE_URL || 'postgres://postgres:postgres@localhost:5432/dietkem';\r\n\r\n// for query purposes\r\nexport const queryClient = postgres(connectionString);\r\nexport const db = drizzle(queryClient, { schema });\r\n\r\nexport * from './schema'; ","import { pgTable, serial, varchar, timestamp, integer, decimal, text, pgEnum } from 'drizzle-orm/pg-core';\r\n\r\n// Enums\r\nexport const userRoleEnum = pgEnum('user_role', ['dietitian', 'client']);\r\nexport const mealTypeEnum = pgEnum('meal_type', ['breakfast', 'lunch', 'dinner', 'snack']);\r\n\r\n// Users table\r\nexport const users = pgTable('users', {\r\n  id: serial('id').primaryKey(),\r\n  clerk_id: varchar('clerk_id', { length: 255 }).notNull().unique(),\r\n  email: varchar('email', { length: 255 }).notNull().unique(),\r\n  role: userRoleEnum('role').notNull(),\r\n  created_at: timestamp('created_at').defaultNow().notNull(),\r\n  updated_at: timestamp('updated_at').defaultNow().notNull(),\r\n});\r\n\r\n// Clients table\r\nexport const clients = pgTable('clients', {\r\n  id: serial('id').primaryKey(),\r\n  user_id: integer('user_id').references(() => users.id).notNull(),\r\n  name: varchar('name', { length: 255 }).notNull(),\r\n  gender: varchar('gender', { length: 50 }),\r\n  birth_date: timestamp('birth_date'),\r\n  height_cm: decimal('height_cm', { precision: 5, scale: 2 }),\r\n  weight_kg: decimal('weight_kg', { precision: 5, scale: 2 }),\r\n  goal: text('goal'),\r\n  notes: text('notes'),\r\n  created_at: timestamp('created_at').defaultNow().notNull(),\r\n});\r\n\r\n// Measurements table\r\nexport const measurements = pgTable('measurements', {\r\n  id: serial('id').primaryKey(),\r\n  client_id: integer('client_id').references(() => clients.id).notNull(),\r\n  date: timestamp('date').notNull(),\r\n  weight_kg: decimal('weight_kg', { precision: 5, scale: 2 }).notNull(),\r\n  waist_cm: decimal('waist_cm', { precision: 5, scale: 2 }),\r\n  body_fat_percent: decimal('body_fat_percent', { precision: 4, scale: 2 }),\r\n});\r\n\r\n// Meal plans table\r\nexport const meal_plans = pgTable('meal_plans', {\r\n  id: serial('id').primaryKey(),\r\n  client_id: integer('client_id').references(() => clients.id).notNull(),\r\n  start_date: timestamp('start_date').notNull(),\r\n  end_date: timestamp('end_date').notNull(),\r\n  total_calories: integer('total_calories').notNull(),\r\n  notes: text('notes'),\r\n  created_by: integer('created_by').references(() => users.id).notNull(),\r\n});\r\n\r\n// Meal plan days table\r\nexport const meal_plan_days = pgTable('meal_plan_days', {\r\n  id: serial('id').primaryKey(),\r\n  meal_plan_id: integer('meal_plan_id').references(() => meal_plans.id).notNull(),\r\n  date: timestamp('date').notNull(),\r\n  notes: text('notes'),\r\n});\r\n\r\n// Meals table\r\nexport const meals = pgTable('meals', {\r\n  id: serial('id').primaryKey(),\r\n  meal_plan_day_id: integer('meal_plan_day_id').references(() => meal_plan_days.id).notNull(),\r\n  meal_type: mealTypeEnum('meal_type').notNull(),\r\n  name: varchar('name', { length: 255 }).notNull(),\r\n  calories: integer('calories').notNull(),\r\n  protein_g: decimal('protein_g', { precision: 5, scale: 2 }).notNull(),\r\n  carbs_g: decimal('carbs_g', { precision: 5, scale: 2 }).notNull(),\r\n  fat_g: decimal('fat_g', { precision: 5, scale: 2 }).notNull(),\r\n  description: text('description'),\r\n});\r\n\r\n// Foods table\r\nexport const foods = pgTable('foods', {\r\n  id: serial('id').primaryKey(),\r\n  name: varchar('name', { length: 255 }).notNull(),\r\n  description: text('description'),\r\n  calories_per_100g: integer('calories_per_100g').notNull(),\r\n  protein_per_100g: decimal('protein_per_100g', { precision: 5, scale: 2 }).notNull(),\r\n  carbs_per_100g: decimal('carbs_per_100g', { precision: 5, scale: 2 }).notNull(),\r\n  fat_per_100g: decimal('fat_per_100g', { precision: 5, scale: 2 }).notNull(),\r\n  locale: varchar('locale', { length: 10 }).notNull().default('en'),\r\n});\r\n\r\n// Water logs table\r\nexport const water_logs = pgTable('water_logs', {\r\n  id: serial('id').primaryKey(),\r\n  client_id: integer('client_id').references(() => clients.id).notNull(),\r\n  date: timestamp('date').notNull(),\r\n  value_liters: decimal('value_liters', { precision: 4, scale: 2 }).notNull(),\r\n});\r\n\r\n// Weight logs table\r\nexport const weight_logs = pgTable('weight_logs', {\r\n  id: serial('id').primaryKey(),\r\n  client_id: integer('client_id').references(() => clients.id).notNull(),\r\n  date: timestamp('date').notNull(),\r\n  weight_kg: decimal('weight_kg', { precision: 5, scale: 2 }).notNull(),\r\n}); "],"mappings":"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","names":["postgres"]}